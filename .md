|

```
## 在巡店项目中大家会看到wasm文件，jessibuca里的视频转码等也是用wasm。一些视频网站、剪辑网站以及3d类网站资源里也是使用.wasm文件。

## 是什么？
>一种低级的类汇编语言，具有紧凑的二进制格式，可以接近原生的性能运行.支持多种编程语言C / C++ / Rust

> 解释型语言的执行速度要慢于编译型语言，而wasm不用解释，直接是二进制格式。

 ## 做什么？
游戏开发、图像和视频处理、科学计算、虚拟现实、物联网设备等领域。
它扩展了Web平台的能力，使开发者能够构建更复杂、更高性能的Web应用程序，
而不仅仅局限于传统的基于JavaScript的开发。

## 案例

- 2018年，Figma接入asm.js加快文档读写速度，后续改用至WebAssembly。
- 2019年，Adobe宣布正在快马加鞭地开发可在浏览器运行的Photoshop版本
- 2020年，AutoCAD通过集成WebAssemlby发布可在浏览器运行的版本，无需安装本地软件
- 2020年，Google Earth宣布使用WebAssembly将3D可视化迁移至浏览器端。
- ...
## 如何编译？  

 ![com.png](https://www.luotongtong.top/transfer/photo/com.png)

 ### 所需环境
- node
- git
- python
- Emscripten

### 流程
- mkdir webassemblytest
- cd webassemblytest , git clone https://github.com/juj/emsdk.git
- cd emsdk
- emsdk.bat update
- git pull
- emsdk.bat install latest
- emsdk.py activate latest
- e:path\webassemblytest\emsdk\emsdk_env.bat
- emcc-v

## 写个c++demo
```

#include <stdio.h>
#include <emscripten.h>
extern "C"
{
  EMSCRIPTEN_KEEPALIVE

  int add(int a, int b)
  {
    return a + b;
  }
}

```
emcc demo.cpp - o demo.html(指令可配置)  
对应会产生三个文件

- demo.html(emrun--no_browser--port 8080 demo.html) 
- demo.js(胶水代码,用于将 C++ 与 JavaScript 运行时连接起来，使 C++ 代码能够在 JavaScript 环境中运行) 
- demo.wasm

![com.png](https://www.luotongtong.top/transfer/photo/file.png)

 ## wasm文件在JavaScript中使用
```

let arg1 = 2;
let arg2 = 4;
function loadWasm(path = 'demo.wasm') {
  return fetch(path).then(r => r.arrayBuffer()).then(WebAssembly.instantiate).then(module => {
    const instance = module.instance;
    const result = instance.exports.add(arg1,arg2)
    console.log("Result by js:", result);
  }).catch(e => {
    console.log(e)
  })
}
Module.onRuntimeInitialized = function () {
  const result = Module._add(arg1,arg2);
  console.log("Result by js:", result);
};

```


![com.png](https://www.luotongtong.top/transfer/photo/res.png)
```

|  |
| - |
