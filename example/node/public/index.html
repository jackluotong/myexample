<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%=htmlWebpackPlugin.options.title%></title>
    <script src="<%= htmlWebpackPlugin.files.js %>"></script>
    <style>
      .output-wrapper{
        display: grid;
        margin: 10px 0 0 0;
        width: 400px;
        height: 400px;
        background-color: rgb(7, 7, 7);
      }
      .input-wrapper{
        background-color: rgba(136, 126, 126, 0.2);
        display: grid;
        width: 400px;
      }
    </style>
</head>
<body>
  <div class="input-wrapper">
      <div>
        <label for="">文件形式上传</label>
        <input type="file" id="videoInput">
      </div>
      <!-- <div>
        <label for="">blob形式</label>
      </div> -->
      
  </div>
    <div class="output-wrapper">
        <div class="content-wrapper">
        </div>
    </div>
<script>
const videoInput = document.getElementById('videoInput');
const recordDom = document.getElementsByClassName('content-wrapper')[0];
const infoList = []; // 用于存储消息列表

videoInput.addEventListener('change', async () => {
  const selectedFile = videoInput.files[0];

  if (selectedFile) {
    const formData = new FormData();
    formData.append('file', selectedFile);

    try {
      let myInit = {
        method: "POST",
        mode: "cors",
        cache: "default",
        body: formData
      };
      addInfo('转码开始');
      const response = await fetch('http://127.0.0.1:30001/convert', myInit);

      if (response.ok) {
        const videoBlob = await response.blob();
        console.log(videoBlob);        
        addInfo('转码成功');
      } else {
        addInfo('视频转码失败');
      }
    } catch (error) {
      addInfo('发生错误:', error);
    }
  }
});

function downloadFile(blob) {
  var url = window.URL.createObjectURL(blob);
  var a = document.createElement('a');
  a.href = url;
  a.style.display = 'none';
  a.download = `${new Date()}.mp4`;
  document.body.appendChild(a); 
  a.click();
  document.body.removeChild(a); 
}

function addInfo(message) {
  const timestamp = new Date().toLocaleString();
  const messageElement = document.createElement('p');
  messageElement.style.color = '#ffff';
  messageElement.innerHTML = `${timestamp} -- ${message}`;

  // 将新消息追加到消息列表中
  infoList.push(message);
  recordDom.appendChild(messageElement);
}
</script>

</body>
</html>