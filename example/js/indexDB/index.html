<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <script>
        async function initIndexedDB() {
                const indexedDB = window.indexedDB || window.mozIndexedDB || window.webkitIndexedDB || window.msIndexedDB;

                return new Promise((resolve, reject) => {
                    const request = indexedDB.open('ErrorDB', 1);

                    request.onupgradeneeded = function(event) {
                    const db = event.target.result;
                    if (!db.objectStoreNames.contains('errors')) {
                        db.createObjectStore('errors', { keyPath: 'timestamp' });
                    }
                    };

                    request.onsuccess = function(event) {
                    const db = event.target.result;
                    resolve(db);
                    };

                    request.onerror = function(event) {
                    console.error("IndexedDB error:", event.target.error);
                    reject(event.target.error);
                    };
                });
                }

                // 使用示例
                async function saveErrorLog(timestamp, errorMessage) {
                try {
                    const db = await initIndexedDB();
                    const transaction = db.transaction('errors', 'readwrite');
                    const errorStore = transaction.objectStore('errors');

                    const errorData = {
                    timestamp: timestamp,
                    message: errorMessage,
                    };

                    errorStore.add(errorData);
                    await transaction.complete;
                    console.log('Error log saved successfully');
                } catch (error) {
                    console.error('Error saving error log:', error);
                }
                }

                // 调用示例
                const currentTimestamp = new Date().getTime();
                const errorMessage = 'Sample error message';
                saveErrorLog(currentTimestamp, errorMessage);

    </script>
</body>
</html>